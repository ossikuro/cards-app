//—Ö—É–∫–∏
import { useContext, useState } from 'react'
import { useSelector } from 'react-redux'
//–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
import Controls from '../../components/Controls/index.jsx'
import Header from '../../components/Header/Header.jsx'
import WordListTraining from '../../components/WordListTraining/WordListTraining'

import { AppContext } from '../../store/contextTrue'

//–∫–∞—Ä—Ç–∏–Ω–∫–∏, –∏–∫–æ–Ω–∫–∏, —Å—Ç–∏–ª–∏
import BackButton from '../../assets/icons/chevron_left.svg?react'
import emptyImage from '../../assets/emptyImage.png'
import './TrainingPage.scss'

const TrainingPage = () => {
    //const navigate = useNavigate()
    //const dispatch = useDispatch()

    const { activeTheme, setMode } = useContext(AppContext)

    const activeThemeId = useSelector(
        (state) => state.themesStore.activeThemeId
    )

    const allWords = activeTheme?.words || []
    const themeName = activeTheme?.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è'

    const [learnedCount, setLearnedCount] = useState(0)

    const words = allWords.filter((item) => {
        if (!item) return false
        if (!item.english || item.english.trim() === '') return false
        if (!item.russian || item.russian.trim() === '') return false
        return true
    })

    return (
        <>
            <Header
                menuItems={[
                    {
                        label: '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å',
                        onClick: () => {
                            setMode('edit')
                            navigate('/collection')
                        },
                    },
                    {
                        label: '–£–¥–∞–ª–∏—Ç—å',
                        onClick: () => {
                            setMode('view')
                            navigate('/collection')
                        },
                    },
                ]}
            >
                <Controls.Button
                    variant="transparent_icon"
                    aria-label="–ù–∞–∑–∞–¥"
                    onClick={() => window.history.back()}
                    icon={<BackButton />}
                />
                <div className="header_title_text">
                    {themeName}
                    <div className="header_title_wordsCounter">
                        {`–í—ã—É—á–µ–Ω–æ ${learnedCount} —Å–ª–æ–≤ –∏–∑ ${words.length}`}
                    </div>
                </div>
                <Controls.Button
                    variant="black_txt"
                    onClick={() => {
                        setMode('view')
                        navigate('/collection')
                    }}
                >
                    –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–ª–æ–≤
                </Controls.Button>
            </Header>

            {words.length > 0 ? (
                <WordListTraining
                    words={words}
                    setLearnedCount={setLearnedCount}
                />
            ) : (
                <div className="training_empty">
                    <img
                        src={emptyImage}
                        alt="–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, —Ç—ã –≤—Å—ë –≤—ã—É—á–∏–ª!"
                        className="training_empty_image"
                    />
                    <p className="training_empty_text">
                        –ó–¥–µ—Å—å –ø—Ä–æ—Å—Ç–æ –Ω–µ—Ç —Å–ª–æ–≤ ü•±
                    </p>
                </div>
            )}
        </>
    )
}

export default TrainingPage
